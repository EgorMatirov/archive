<% c++ #include "bacs/archive/web/content/form.hpp" %>
<% c++ #include "bacs/archive/web/filters/base64_binary.hpp" %>
<% skin plain %>
    <% view insert uses bacs::archive::web::content::insert extends base_form %>
        <% template subtitle() %>
            <% gt "Insert problems" %>
        <% end template %>
        <% template form() %>
            <p><% gt "Insert problems in archive" %></p>
            <form method="post" action="" enctype="multipart/form-data">
                <% form as_p form %>
            </form>
        <% end template %>
        <% template result() %>
            <% if result %>
                <% foreach id_import in result.get() %>
                    <table>
                        <caption><% gt "Insertion results" %></caption>
                        <tr>
                            <th><% gt "Problem" %></th>
                            <th><% gt "Error" %></th>
                            <th><% gt "Flags" %></th>
                            <th><% gt "Hash" %></th>
                        </tr>
                        <% item %>
                            <tr>
                                <td><%= id_import.first %></td>
                                <td>
                                    <% if id_import.second.error %>
                                        <%= id_import.second.error.get() %>
                                    <% else %>
                                        <% gt "OK" %>
                                    <% end %>
                                </td>
                                <% if id_import.second.status %>
                                    <td>
                                        <% foreach flag in id_import.second.status->flags %>
                                            <ul class="problem_flags">
                                                <% item %>
                                                    <li><%= flag %></li>
                                                <% end %>
                                            </ul>
                                        <% end %>
                                    </td>
                                    <td><%= id_import.second.status->hash | base64_binary %></td>
                                <% else %>
                                    <!-- Nothing here... -->
                                <% end %>
                            </tr>
                        <% end %>
                    </table>
                <% empty %>
                    <% gt "There are no inserted problems." %>
                <% end %>
            <% end %>
        <% end template %>
    <% end view %>
<% end skin %>
